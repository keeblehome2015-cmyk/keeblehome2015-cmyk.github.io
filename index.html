<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>File Receiver – GitHub Pages</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body {font-family: system-ui, sans-serif; margin: 2rem; background:#f9f9fb; color:#222;}
        h1 {margin-bottom: .5rem;}
        #dropzone {
            border: 3px dashed #777;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            background: #fff;
            transition: background .2s;
        }
        #dropzone.dragover {background:#e1f5fe; border-color:#2196f3;}
        #output {margin-top: 2rem;}
        .file {margin: .5rem 0; padding: .75rem; background:#fff; border-radius:8px; box-shadow:0 1px 3px rgba(0,0,0,.1);}
        .file img, .file pre {max-width:100%; margin-top:.5rem;}
        .error {color:#b00020;}
    </style>
</head>
<body>

<h1>File Receiver</h1>
<p>POST files to this page from anywhere, or drag-and-drop them here.</p>

<div id="dropzone">
    Drop files here or <label><input type="file" id="fileInput" multiple style="display:none;">click to select</label>
</div>

<div id="output"></div>

<script>
/* -------------------------------------------------------------
   1. Handle direct <form> POSTs (multipart/form-data)
   ------------------------------------------------------------- */
async function handleFormPost(event) {
    event.preventDefault();               // stop normal navigation
    const formData = new FormData(event.target);
    await displayFiles(formData);
}

/* -------------------------------------------------------------
   2. Handle drag-and-drop or file-input selection
   ------------------------------------------------------------- */
const dropzone   = document.getElementById('dropzone');
const fileInput  = document.getElementById('fileInput');
const output     = document.getElementById('output');

dropzone.addEventListener('click', () => fileInput.click());

fileInput.addEventListener('change', () => {
    const dt = new DataTransfer();
    for (const f of fileInput.files) dt.items.add(f);
    displayFiles(dt.files);
});

['dragover', 'dragenter'].forEach(ev => {
    dropzone.addEventListener(ev, e => {
        e.preventDefault();
        dropzone.classList.add('dragover');
    });
});
['dragleave', 'dragend', 'drop'].forEach(ev => {
    dropzone.addEventListener(ev, e => {
        e.preventDefault();
        dropzone.classList.remove('dragover');
    });
});
dropzone.addEventListener('drop', e => {
    e.preventDefault();
    displayFiles(e.dataTransfer.files);
});

/* -------------------------------------------------------------
   3. Core: read and render each file
   ------------------------------------------------------------- */
async function displayFiles(source) {
    output.innerHTML = '';               // clear previous results

    // source can be FileList or FormData
    const files = source instanceof FormData ? Array.from(source.values()) : Array.from(source);

    for (const file of files) {
        const div = document.createElement('div');
        div.className = 'file';

        const name = document.createElement('strong');
        name.textContent = file.name || file.fieldName || 'unknown';
        div.appendChild(name);

        try {
            if (file.type.startsWith('image/')) {
                const img = document.createElement('img');
                img.src = URL.createObjectURL(file);
                div.appendChild(img);
            } else if (file.type === 'application/json' || file.name.endsWith('.json')) {
                const txt = await file.text();
                const pre = document.createElement('pre');
                pre.textContent = JSON.stringify(JSON.parse(txt), null, 2);
                div.appendChild(pre);
            } else {
                // treat everything else as plain text
                const txt = await file.text();
                const pre = document.createElement('pre');
                pre.textContent = txt;
                div.appendChild(pre);
            }
        } catch (err) {
            const errSpan = document.createElement('span');
            errSpan.className = 'error';
            errSpan.textContent = `Error reading file: ${err.message}`;
            div.appendChild(errSpan);
        }

        output.appendChild(div);
    }
}

/* -------------------------------------------------------------
   4. Intercept any POST that lands on this page
   ------------------------------------------------------------- */
if (window.location.search.includes('post=1')) {
    // GitHub Pages will reload the page with the posted body as query string – not useful.
    // Instead we expose a tiny endpoint via a hidden form that external scripts can submit to.
    // The trick below lets *any* site POST to us using fetch + formData.
    // (GitHub Pages still serves only the static file, but the browser can receive the payload.)
    // -------------------------------------------------
    // This part is **optional** – it creates a tiny "receiver" form that external scripts can target.
    const receiverForm = document.createElement('form');
    receiverForm.method = 'POST';
    receiverForm.enctype = 'multipart/form-data';
    receiverForm.style.display = 'none';
    receiverForm.addEventListener('submit', handleFormPost);
    document.body.appendChild(receiverForm);
}

/* -------------------------------------------------------------
   5. Public helper for external scripts (copy-paste)
   ------------------------------------------------------------- */
console.log('%cSend files to this page with:\n' +
    'fetch(location.href, {method:"POST", body: formData})',
    'font-weight:bold; color:#006400;');
</script>

</body>
</html>
